/*! jQuery.touchdragh (https://github.com/Takazudo/jQuery.touchdragh)
 * lastupdate: 2013-03-05
 * version: 0.0.0
 * author: Takeshi Takatsudo 'Takazudo' <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=function(t,e){return function(){return t.apply(e,arguments)}};(function(e,i,o){var s,h;return s=e(o),h=e.TouchdraghNs={},h.normalizeXY=function(t){var e,n,r;return n={},e=t.originalEvent,null!=e.changedTouches?(r=e.changedTouches[0],n.x=r.pageX,n.y=r.pageY):(n.x=t.pageX||e.pageX,n.y=t.pageY||e.pageY),n},h.support={},h.ua={},h.support.addEventListener="addEventListener"in o,h.support.touch="ontouchend"in o,h.support.mspointer=i.navigator.msPointerEnabled||!1,h.ua.win8=/Windows NT 6\.2/i.test(navigator.userAgent),h.touchStartEventName=function(){return h.support.mspointer?"MSPointerDown":h.ua.win8?"touchstart mousedown":h.support.touch?"touchstart":"mousedown"}(),h.touchMoveEventName=function(){return h.support.mspointer?"MSPointerMove":h.ua.win8?"touchmove mousemove":h.support.touch?"touchmove":"mousemove"}(),h.touchEndEventName=function(){return h.support.mspointer?"MSPointerUp":h.ua.win8?"touchend mouseup":h.support.touch?"touchend":"mouseup"}(),h.getLeftPx=function(t){var e;return e=t.css("left"),e="auto"===e?0:1*e.replace(/px/,"")},h.startWatchGestures=function(){var t,e;return e=!1,t=function(){return e=!0,s.on("gesturestart",function(){return h.whileGesture=!0}),s.on("gestureend",function(){return h.whileGesture=!1})},function(){return this.initDone?void 0:t()}}(),h.Event=function(){function e(){}return e.prototype.on=function(t,e){var n,r,i,o,s;for(null==this._callbacks&&(this._callbacks={}),n=t.split(" "),o=0,s=n.length;s>o;o++)r=n[o],(i=this._callbacks)[r]||(i[r]=[]),this._callbacks[r].push(e);return this},e.prototype.once=function(t,e){return this.on(t,function(){return this.off(t,arguments.callee),e.apply(this,arguments)})},e.prototype.trigger=function(){var e,n,r,i,o,s,h;if(e=arguments.length>=1?t.call(arguments,0):[],r=e.shift(),i=null!=(h=this._callbacks)?h[r]:void 0){for(o=0,s=i.length;s>o&&(n=i[o],n.apply(this,e)!==!1);o++);return this}},e.prototype.off=function(t,e){var n,r,i,o,s,h;if(!t)return this._callbacks={},this;if(i=null!=(h=this._callbacks)?h[t]:void 0,!i)return this;if(!e)return delete this._callbacks[t],this;for(r=o=0,s=i.length;s>o;r=++o)if(n=i[r],n===e){i=i.slice(),i.splice(r,1),this._callbacks[t]=i;break}return this},e}(),h.OneDrag=function(t){function e(){this._scrollDirectionDecided=!1}return n(e,t),e.prototype.applyTouchStart=function(t){var e;return e=h.normalizeXY(t),this.startPageX=e.x,this.startPageY=e.y,this},e.prototype.applyTouchMove=function(t){var e,n,r,i,o=this;return e=h.normalizeXY(t),i=function(){var t;return t=e.x-o.startPageX,o.trigger("dragmove",{x:t})},this._scrollDirectionDecided?i():(n=Math.abs(e.x-this.startPageX),r=Math.abs(e.y-this.startPageY),(n>5||r>5)&&(this._scrollDirectionDecided=!0,n>5?this.trigger("xscrolldetected"):r>5&&this.trigger("yscrolldetected"))),this},e.prototype.destroy=function(){return this.off(),this},e}(h.Event),h.TouchdraghEl=function(t){function i(t,n){this.$el=t,this._handleTouchEnd=r(this._handleTouchEnd,this),this._handleTouchMove=r(this._handleTouchMove,this),this._handleTouchStart=r(this._handleTouchStart,this),this._firstRefreshDone=!1,this.el=this.$el[0],this.options=e.extend({},this.defaults,n),this.disabled=!1,h.startWatchGestures(),this._handlePointerEvents(),this._prepareEls(),this._eventify(),this.refresh()}return n(i,t),i.prototype.defaults={backanim_duration:250,backanim_easing:"swing",beforefirstrefresh:null},i.prototype.refresh=function(){return this._calcMinMaxLeft(),this._handleTooNarrow(),this._handleInnerOver(),this._firstRefreshDone||(this.options.beforefirstrefresh&&this.options.beforefirstrefresh(this),this.trigger("touchdragh.firstrefresh"),this._firstRefreshDone=!0),this.trigger("touchdragh.refresh"),this},i.prototype._handlePointerEvents=function(){return h.support.mspointer?(this.el.style.msTouchAction="none",this):this},i.prototype._prepareEls=function(){return this.$inner=this.$el.find(this.options.inner),this},i.prototype._calcMinMaxLeft=function(){return this._maxLeft=0,this._minLeft=-(this.$inner.outerWidth()-this.$el.innerWidth()),this},i.prototype._eventify=function(){return this.$el.on(h.touchStartEventName,this._handleTouchStart),h.support.addEventListener&&this.el.addEventListener("click",e.noop,!0),this},i.prototype._handleTouchStart=function(t){var e,n=this;return this.disabled?this:this._whileDrag?this:h.whileGesture?this:("mouedown"===t.type&&t.preventDefault(),this._whileDrag=!0,this._shouldSlideInner=!1,e=this._currentDrag=new h.OneDrag,e.on("yscrolldetected",function(){return n._whileDrag=!1}),e.on("xscrolldetected",function(){return n._shouldSlideInner=!0,n.trigger("touchdragh.start")}),e.on("dragmove",function(t){return n.trigger("touchdragh.drag"),n._moveInner(t.x)}),this._innerStartLeft=h.getLeftPx(this.$inner),e.applyTouchStart(t),s.on(h.touchMoveEventName,this._handleTouchMove),s.on(h.touchEndEventName,this._handleTouchEnd),this)},i.prototype._handleTouchMove=function(t){return this._whileDrag?h.whileGesture?this:(this._currentDrag.applyTouchMove(t),this._shouldSlideInner&&(t.preventDefault(),t.stopPropagation()),this):this},i.prototype._handleTouchEnd=function(){return this._whileDrag=!1,s.off(h.touchMoveEventName,this._handleTouchMove),s.off(h.touchEndEventName,this._handleTouchEnd),this._currentDrag.destroy(),this._handleInnerOver(!0),this},i.prototype._moveInner=function(t){var e,n;return n=this._innerStartLeft+t,n>this._maxLeft?n=this._maxLeft+(n-this._maxLeft)/3:this._minLeft>n&&(n=this._minLeft+(n-this._minLeft)/3),this.$inner.css("left",n),e={left:n},this.trigger("touchdragh.move",e),this},i.prototype._handleInnerOver=function(t){var e,n,r,i,o,s=this;return null==t&&(t=!1),this.isInnerTooNarrow()?this:(o=function(){return t?s.trigger("touchdragh.end"):void 0},i=null,n=h.getLeftPx(this.$inner),r=n>this._maxLeft,e=this._minLeft>n,r||e?(r&&(i=this._maxLeft),e&&(i=this._minLeft),this.slideInner(i,!0,function(){return o()}),this):(o(),this))},i.prototype._handleTooNarrow=function(){return this.isInnerTooNarrow()?(this.disable(),this.$inner.css("left",0)):this.enable(),this},i.prototype.isInnerTooNarrow=function(){var t,e;return t=this.$el.width(),e=this.$inner.width(),t>=e},i.prototype.disable=function(){return this.disabled=!0,this},i.prototype.enable=function(){return this.disabled=!1,this},i.prototype.slideInner=function(t,n,r){var i,o,s,h=this;return null==n&&(n=!1),t>this._maxLeft&&(t=this._maxLeft),this._minLeft>t&&(t=this._minLeft),i=this.options.backanim_duration,o=this.options.backanim_easing,s={left:t},e.Deferred(function(t){var e;return h.trigger("touchdragh.beforeinnerslide"),e=function(){return h.trigger("touchdragh.afterinnerslide"),null!=r&&r(),t.resolve()},n?h.$inner.stop().animate(s,i,o,function(){return e()}):(h.$inner.stop().css(s),e())}).promise()},i}(h.Event),e.fn.touchdragh=function(t){return null==t&&(t={}),this.each(function(n,r){var i,o;return i=e(r),o=new h.TouchdraghEl(i,t),i.data("touchdragh",o),this})},e.Touchdragh=h.TouchdraghEl})(jQuery,window,document)}).call(this);